<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>WebCam over WebSocket</title>
  </head>
  <body>
    <h2> WebCam Receiver </h2>
    <img src="" id="frame" style="width:400px;height:240px"/>
    <div id="log"><!-- Log Corner --></div>
    
    <script type="text/javascript">
      if ('MozWebSocket' in window) {
          window.WebSocket = window.MozWebSocket;
      }

      if ('WebSocket' in window) {
        connect("${web.socket.location}");
      } else {
        log ('web sockets not supported');
      }

      function connect(host) {
        var localWebSocket = new WebSocket(host);
        
        localWebSocket.onopen = function () {
          log('connected');
        };

        localWebSocket.onclose = function () {
          log('socket closed');
        };

        localWebSocket.onerror = function (evt) {
            log('socket error: ' + evt.data);
        };
        
        localWebSocket.onmessage = function (evt) {  	
          if (evt.data != null) {		
            if ((evt.data[0]=== "d") && (evt.data[1]==="a")) {
              var img = document.getElementById("frame"); 
              img.src=evt.data;
            }
          }
        };       
      };

      function log(msg){
        document.getElementById('log').innerHTML = msg + "<br/>";
      }
    </script>
  </body>
</html>
