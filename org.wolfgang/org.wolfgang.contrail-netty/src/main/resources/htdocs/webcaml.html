<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>WebCam over WebSocket</title>
  </head>
  <body>
    <img src="" id="frame" style="width:240px;height:400px"/>
    <div id="log"><!-- Log Corner --></div>
    
    <script type="text/javascript">
      var img; 
      
      function Init() {
       	img = document.getElementById("frame");	
      }

      $(document).ready(function () {
        Init();
      });

      var webSocket;
      
      if (!window.WebSocket) {
          window.WebSocket = window.MozWebSocket;
      }

      if (window.WebSocket) {
          webSocket = new WebSocket("${web.socket.location}");
      } else {
        log ('web sockets not supported');
      }

      function connect(host) {
        webSocket = new WebSocket(host);
        webSocket.onopen = function () {
          log('connected');
        };

        webSocket.onmessage = function (evt) {  	
          if (evt.data != null) {		
            if ((evt.data[0]=== "d") && (evt.data[1]==="a")) {
              img.src=evt.data;
            }
          }
        };

        webSocket.onclose = function () {
          log('socket closed');
        };

        webSocket.onerror = function (evt) { 
          log("socket error: " + evt.data); 
        };
      };

      function log(msg){
        document.getElementById('log').innerHTML = msg + "<br/>" + document.getElementById('log').innerHTML ;
      }
    </script>
  </body>
</html>
